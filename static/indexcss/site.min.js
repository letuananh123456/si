!function(e){var a={init:function(){var t;a.init_plupload(".upload"),a.init_datepicker(".datepicker"),a.init_sliders(".slider"),e(document).on("keyup",".form-group--slider input",function(){a.update_slider(e(this))}),a.init_accordions(".accordion"),a.init_carousels(".carousel"),e(document).on("click",".carousel-nav",function(t){t.preventDefault(),a.navigate_carousel(e(this))}),e(document).on("click",".toggle-menu",function(e){e.preventDefault(),a.toggle_menu()}),e(document).on("click",".menu-item-has-children > a",function(t){t.preventDefault(),a.toggle_sub_menu(e(this)),e(".menu-container__overlay").addClass("active")}),e(document).on("click",".menu-container__overlay",function(a){a.preventDefault(),e(".menu-item-has-children").removeClass("active"),e(this).removeClass("active")}),e(document).on("click",".toggle-phone",function(e){e.preventDefault(),a.toggle_phone()}),e(document).on("click",".to-top",function(a){a.preventDefault(),e("html, body").animate({scrollTop:0},"slow")}),a.init_maps(".map"),e(document).on("keyup",'[data-pcapredict="1"]',function(t){var i="postcode"==e(this).attr("id");a.postcode_lookup(e(this),i)}),e(document).on("click",".address-option",function(t){t.preventDefault(),a.select_postcode(e(this))}),e(document).on("input keyup","#car_registration",function(a){e(this).val(a.target.value.toUpperCase())}),e(document).on("click","#find-car",function(t){t.preventDefault(),a.select_car_reg(e(this))}),e(document).on("click",".add-damage",function(t){t.preventDefault(),a.select_damage(e(this))}),e(document).on("click",".remove-damage",function(t){t.preventDefault(),a.remove_damage(e(this))}),e("#claim").on("change",".claim-form input[type=radio]",function(e){return a.check_progress(e)}),e("#claim").on("click","button[data-action=new-claim]",function(a){e("#claim").find(".select").hide(),e("#claim").find(".search").hide(),e("#claim").find(".proceed").show()}),e("#claim").on("click","button[data-action=update-claim]",function(a){e("#claim").find(".select").hide(),e("#claim").find(".proceed").hide(),e("#claim").find(".search").show()}),e(document).on("input",".upload-size",function(){var a={},i=e(this);""!==i.val()&&(clearTimeout(t),i.val(i.val().replace(/\D/g,"")),!0,a.size=i.val(),a.key=i.data("key"),a.postid=i.data("postid"),a.action="update_damage_size",t=window.setTimeout(function(){e.post(localizedData.ajax_url,a,function(e){i.val(e.size)},"json")},500))}),e(".helptip").tooltip(),e(document).on("click",".claim-form button.bg-green",function(t){t.preventDefault();var i=e(this).parents(".claim-form");"review"==i.attr("id")?a.submit_final_claim(i):a.submit_claim(i)}),e(".claim-search-form").on("submit",function(a){a.preventDefault();var t=e(this);e("#claim").find(".search").hide(),e("#claim").find(".select").show(),e("#spinner").show();var i=document.getElementById("claim_search_results"),s=document.getElementById("claim_search_instructions");i.innerHTML="",s.innerHTML="",e.post(t.attr("action"),t.serialize(),function(a){if(e("#spinner").hide(),instruction_node=document.createTextNode("There were no search results returned."),!a.error&&a.result.length>0){for(var t in a.result){var n=document.createElement("div"),o=document.createElement("div"),r=document.createElement("div");heading_node=document.createTextNode(a.result[t].claim),panel_body=document.createElement("div"),body_node=document.createTextNode("Date of Claim: "+a.result[t].date),n.className="panel-container",o.className="panel panel-default existing-claim",o.dataset.guid=a.result[t].guid,o.dataset.claimid=a.result[t].claim,r.className="panel-heading",panel_body.className="panel-body",r.appendChild(heading_node),panel_body.appendChild(body_node),o.appendChild(r),o.appendChild(panel_body),n.appendChild(o),i.appendChild(n)}instruction_node=document.createTextNode("select from above, or")}s.appendChild(instruction_node)},"json")}),e("#claim_search_results").on("click",".existing-claim",function(a){a.preventDefault();var t={},i=e(this);t.guid=e(this).data("guid"),t.claimid=e(this).data("claimid"),t.action="api_load_claim",e.post(localizedData.ajax_url,t,function(e){e.error?(errorContainer=document.createElement("span"),errorContainer.className="error_message",errorMessageStr=". "+e.error_message[0]+". There appears to be a problem. Please contact Smart Insurance",error_node=document.createTextNode(errorMessageStr),errorContainer.appendChild(error_node),i.find(".panel-body").append(errorContainer)):location.reload()},"json")}),a.update_claim(),e(document).on("click",".banner .button",function(a){e(this).attr("href").indexOf("#video")>=0&&(a.preventDefault(),e('[data-target="#video"]').click())}),a.add_close(),e(document).on("click",".sub-menu .zmdi-close",function(t){t.preventDefault(),a.close_sub_menu(e(this)),e(".menu-container__overlay").removeClass("active")}),e(document).on("click",".nf-field-element .button",function(a){var t=e(".nf-form-title h3").text();__gaTracker("send","event","Form","Submitted",t)})},init_plupload:function(a){var t=e(a);t.length&&t.each(function(a){var t=e(this),i=e(this).find(".upload-button").attr("id"),s=new plupload.Uploader({runtimes:"html5,flash,silverlight,html4",browse_button:i,url:"?plupload=true",filters:{max_file_size:"10mb",mime_types:[{title:"Image files",extensions:"png,jpg,jpeg,JPEG,gif,eps"}]},flash_swf_url:"/styleguide/plugins/plupload-2.3.1/js/Moxie.swf",silverlight_xap_url:"/styleguide/plugins/plupload-2.3.1/js/Moxie.xap",preinit:{},init:{PostInit:function(){},FilesAdded:function(e,a){s.start()},UploadProgress:function(e,a){},Error:function(e,a){alert("There was an issue during the upload: "+a.message+a.code)},FileUploaded:function(a,i,n){var o=e.parseJSON(n.response),r='<div class="upload-thumb" style="background-image: url('+o.filepath+')">';r+='<input type="hidden" name="claim_damage_image[]" value="'+o.image_id+'">',r+="</div>\x3c!-- .upload-thumb --\x3e",t.html(r),s.destroy()}}});s.init()}),navigator.userAgent.match(/(iPod|iPhone|iPad)/)&&e("#browse").click(function(){e("div.moxie-shim input[type=file]").trigger("click")})},init_sliders:function(t){var i=e(t);i.length&&i.each(function(t){var i=e(this).data("range"),s=e(this).data("value"),n=e(this).data("min"),o=e(this).data("max");e(this).slider({range:i,value:s,min:n,max:o,slide:function(t,i){e(this).closest(".form-group").find("input").val(i.value),a.calculate_total()}})})},init_datepicker:function(a){var t=e(a);t.length&&t.each(function(a){e(this).datepicker({dateFormat:"dd MM, yy",maxDate:0})})},update_slider:function(t){var i=t.closest(".form-group").find(".slider"),s=t.val(),n=i.data("min"),o=i.data("max");e.isNumeric(s)&&(parseInt(s)>o&&(s=o,t.val(s)),parseInt(s)<n&&(s=n,t.val(s)),i.slider("value",s),a.calculate_total())},calculate_total:function(){var t=240.17*(e('[name="cars_sold"]').val()*(e('[name="cars_perc"]').val()/100));t=t.toFixed(2),t=a.digits(t.toString()),e(".calculator-total").html(t)},digits:function(e){return e.replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")},init_accordions:function(a){var t=e(a),i={header:"zmdi zmdi-plus-circle col-light-blue",activeHeader:"zmdi zmdi-minus-circle col-red"};t.length&&t.each(function(a){e(this).accordion({icons:i,collapsible:!0})})},init_carousels:function(a){var t=e(a);t.length&&t.each(function(a){if(e(this).find(".item").length>1){e(this).addClass("owl-carousel");var t=e(this).data("loop"),i=e(this).data("dots"),s=(e(this).data("items"),e(this).data("itemsxs")),n=e(this).data("itemssm"),o=e(this).data("itemsmd"),r=e(this).data("itemslg");e(this).owlCarousel({loop:t,dots:i,responsive:{0:{items:s},768:{items:n},992:{items:o},1200:{items:r}}})}})},navigate_carousel:function(e){var a=e.closest(".carousel-container").find(".carousel"),t=(a.data("owlCarousel"),"next");e.hasClass("carousel-nav--prev")&&(t="prev"),a.trigger(t+".owl.carousel")},toggle_phone:function(){e("body").removeClass("menu-active"),e("body").toggleClass("phone-active")},toggle_menu:function(){e("body").removeClass("phone-active"),e("body").toggleClass("menu-active")},toggle_sub_menu:function(a){var t=a.parent();t.hasClass("active")&&(window.location.href=a.attr("href")),e(".menu-item-has-children").removeClass("active"),t.toggleClass("active")},close_sub_menu:function(a){e(".menu-item-has-children").removeClass("active")},init_maps:function(a){var t=e(a);t.length&&t.each(function(a){var i=e(this).data("latitude"),s=e(this).data("longitude"),n=e(this).data("marker"),o=new google.maps.LatLng(i,s),r={zoom:8,mapTypeId:google.maps.MapTypeId.ROAD,scrollwheel:!1,center:o,styles:[{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#444444"}]},{featureType:"landscape",elementType:"all",stylers:[{color:"#f2f2f2"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"all",stylers:[{saturation:-100},{lightness:45}]},{featureType:"road.highway",elementType:"all",stylers:[{visibility:"simplified"}]},{featureType:"road.arterial",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"all",stylers:[{color:"#00adef"},{visibility:"on"}]}]};t.map=new google.maps.Map(document.getElementById("map"),r);(n=new google.maps.Marker({position:o,map:t.map,optimized:!1,animation:google.maps.Animation.DROP,icon:n})).setMap(t.map)})},postcode_lookup:function(a,t){var i=a.parents(".form-group"),s=i.find(".dialog--select"),n=a.val(),o={Key:"PX94-WA23-XG95-YA79",Country:"GBR",LanguagePreference:"EN",MaxSuggestions:15,MaxResults:15};if(t){if(!n.match(/[A-Z][A-Z]?([0-9]{1,2}|[0-9][A-Z])\s*[0-9][A-Z]{2}/i))return!1;o.Postcode=n;r="https://services.postcodeanywhere.co.uk/PostcodeAnywhere/Interactive/FindByPostcode/v1.00/json3.ws?callback=?"}else{o.SearchTerm=n;var r="https://services.postcodeanywhere.co.uk/CapturePlus/Interactive/Find/v2.10/json3.ws?callback=?"}e.getJSON(r,o,function(a){if(1==a.Items.length&&void 0!==a.Items[0].Error){var n=[];n[1001]="Don't forget your address",n[1002]="Is this right?",n[1005]="Don't forget your address";var o=i.find(".help-block"),r=n[a.Items[0].Error];o.text(r),i.addClass("has-error").removeClass("has-success")}else if(0==a.Items.length){r="Sorry there are no results";(o=i.find(".help-block")).text(r),i.addClass("has-error").removeClass("has-success")}else{var l="";e(a.Items).each(function(e){if(l+='<a href="#" data-id="'+a.Items[e].Id+'" class="address-option" data-postcode="'+(t||0)+'">',t)i=a.Items[e].StreetAddress+", "+a.Items[e].Place;else i=a.Items[e].Text;if(i.length>30)var i=i.substring(0,30)+"...";l+=i,l+="</a>"}),s.find(".dialog--select__list").html(l),i.removeClass("has-error").addClass("has-success")}})},select_postcode:function(a){var t=a.data("id"),i=a.parents(".form-group"),s=i.find(".dialog--select"),n=(i.find('[name="claim_address_line_1"]').val(),{Key:"EZ96-ZE79-AJ81-CX69",Id:t}),o="1"==a.attr("data-postcode")||"true"==a.attr("data-postcode");if(o){r="https://services.postcodeanywhere.co.uk/PostcodeAnywhere/Interactive/RetrieveByPostcodeAndBuilding/v1.30/json3.ws?callback=?";n.Postcode=a.parents(".dialog--select").siblings("#postcode").val(),n.Id=parseInt(n.Id)}else var r="https://services.postcodeanywhere.co.uk/CapturePlus/Interactive/Retrieve/v2.10/json3.ws?callback=?";e.getJSON(r,n,function(a){if(1==a.Items.length&&void 0!==a.Items[0].Error){var t=i.find(".help-block"),r=a.Items[0].Description;t.text(r),i.addClass("has-error").removeClass("has-success")}else if(0==a.Items.length){r="Sorry there are no results";(t=i.find(".help-block")).text(r),i.addClass("has-error").removeClass("has-success")}else{if(o){var l=null;for(var c in a.Items)if(a.Items[c].Udprn==n.Id){l=a.Items[c];break}var d=l.Line1,m=l.Line2,u=l.PostTown,p=l.Postcode}else var d=a.Items[0].Line1,m=a.Items[0].Line2,u=a.Items[0].City,p=a.Items[0].PostalCode;e('[name="claim_address_line_1"]').val(d),e('[name="claim_address_line_1"]').parents(".form-group").removeClass("has-error").addClass("has-success"),e('[name="claim_address_line_2"]').val(m),""!=a.Items[0].Line2&&e('[name="claim_address_line_2"]').parents(".form-group").removeClass("has-error").addClass("has-success"),e('[name="claim_address_line_2"]').parents(".form-group").removeClass("hide"),e('[name="claim_town_city"]').val(u),""!=a.Items[0].City&&e('[name="claim_town_city"]').parents(".form-group").removeClass("has-error").addClass("has-success"),e('[name="claim_town_city"]').parents(".form-group").removeClass("hide"),e('[name="claim_postcode"]').val(p),""!=a.Items[0].PostalCode&&e('[name="claim_postcode"]').parents(".form-group").removeClass("has-error").addClass("has-success"),e('[name="claim_postcode"]').parents(".form-group").removeClass("hide"),s.removeClass("active")}})},select_car_reg:function(a){var t=a.parents(".form-group"),i=t.find('[name="claim_car_registration"]'),s=t.parents("form"),n=s.find('[name="claim_car_make"]'),o=s.find('[name="claim_car_model"]'),r={reg:i.val(),action:"get_vehicle"};t.removeClass("has-error"),e.ajax({type:"POST",url:localizedData.ajax_url,dataType:"json",data:r,success:function(e){e.success?(n.val(e.make),o.val(e.model)):t.addClass("has-error")}})},select_damage:function(t){var i=t.data("title"),s=t.data("postid"),n=(t.data("price").toFixed(2),e(".table--damage"));if(e('.table [data-class="'+i+'"]').length)return e(".modal button").click(),!1;var o=e(".table--damage tr").length,r='<tr data-class="'+i+'">';r+='<td><a href="#" class="remove-damage" class="col-red"><i class="zmdi zmdi-close-circle col-red"></i></a> '+i+"</td>",r+='<td class="size align-centre" data-size="0">',r+='<input type="hidden" name="claim_damage_title[]" value="'+i+'">',r+='<input type="text" id="size-'+o+'" class="upload-size" data-key="'+o+'" data-postid="'+s+'" name="claim_damage_size[]" value="" data-required="1">',r+=" cm",r+="</td>",r+='<td class="align-centre upload upload-'+o+' upload-damage">',r+='<button class="upload-button button button--outline border-light-bllue col-light-blue" id="browse-'+o+'">Add Photo</button>',r+='<input type="hidden" name="claim_damage_image[]" value="" data-required="1">',r+="</td>",r+="</tr>",n.find("tbody").append(r);var l=0;e(".table .price").each(function(a){var t=e(this).data("price");l+=t}),e(".damage-cost").html("&pound;"+l.toFixed(2)),e(".modal button").click(),e(".table--damage").removeClass("hide"),a.init_plupload(".upload-"+o)},remove_damage:function(a){a.parents("tr").remove(),e(".table--damage tbody tr").length||e(".table--damage").addClass("hide");var t=0;e(".table .price").each(function(a){var i=e(this).data("price");t+=i}),e(".damage-cost").html("&pound;"+t.toFixed(2))},check_progress:function(a){var t=e(a.target),i={},s=t.val();switch(t.attr("name")){case"claim_circumstances_1":case"claim_circumstances_4":"No"==s&&(i.damage_ineligible=!0);break;case"claim_circumstances_3":"Yes"==s&&(i.damage_ineligible=!0)}if(e.isEmptyObject(i))return!0;a.preventDefault();var n="";return i.damage_ineligible&&(n="Unfortunately the information you’ve provided indicates the damage to your vehicle is ineligible under the terms and conditions of your policy. Please refer to your policy terms and conditions for more information or contact us on 0800 077 8713."),alert(n),a.target.checked=!1,!1},submit_claim:function(t){t.find("button.bg-green").html('Saving <i class="zmdi zmdi-spinner zmdi-hc-spin"></i>');var i=t.serializeArray(),s=parseInt(t.data("step"))+1,n=!1,o=t.find("input, textarea");t.find(".form-fieldset").removeClass("has-error"),e('input[name="update_claim"]').length&&"1"==e('input[name="update_claim"]').val()||o.each(function(t){var i=e(this).data("required"),s=e(this).val(),o=e(this).parents(".form-group"),r=e(this).parents(".form-fieldset"),l=e(this).attr("type"),c=e(this).attr("name");"radio"==l?void 0!=e('[name="'+c+'"]:checked').val()?(o.addClass("has-success"),o.removeClass("has-error")):(o.addClass("has-error"),o.removeClass("has-success"),n=!0,a.errors=!0):i&&""==s?(o.addClass("has-error"),o.removeClass("has-success"),n=!0,a.errors=!0,r.length&&r.addClass("has-error")):(o.addClass("has-success"),o.removeClass("has-error"))}),3==t.data("step")&&(e('input[name="update_claim"]').length&&"1"==e('input[name="update_claim"]').val()||e(".table .size").length&&(e(".table .size").first().data("size")||e(".table .size").first().find("input").val())||(alert("Cannot proceed. No damage selected."),t.addClass("has-error"),t.removeClass("has-success"),n=!0,a.errors=!0)),e.ajax({type:"POST",url:"",dataType:"html",data:i,success:function(i){if("review"==t.attr("id")){if(a.submitted=!0,n){o='Re-Submit <i class="zmdi zmdi-chevron-right"></i>';return(r=t.find("button.bg-green")).html(o),!1}}else{if(n){o='Re-Submit <i class="zmdi zmdi-chevron-right"></i>';return(r=t.find("button.bg-green")).html(o),!1}var o='Saved <i class="zmdi zmdi-check"></i>',r=t.find("button.bg-green");r.html(o);var l=e('.row[data-step="'+s+'"]');l.length&&(l.removeClass("hide"),e('.progress-steps [data-step="'+s+'"]').addClass("active"),e("html, body").animate({scrollTop:l.offset().top},"slow"))}return!0}})},submitted:!1,errors:!1,submit_final_claim:function(t){a.submitted=!1,a.errors=!1,e(".overlay").addClass("active");var i=t.find("button");i.html('Saving <i class="zmdi zmdi-spinner zmdi-hc-spin"></i>');var s=e(".claim-form");e("html, body").animate({scrollTop:e(".claim-form:first").offset().top},"slow");var n=s.length-1;s.each(function(t){if(a.submit_claim(e(this)),n==t){if(a.errors){return i.html('Re-submit <i class="zmdi zmdi-chevron-right"></i>'),!1}e('[name="complete"]').val(1),setTimeout(function(){e("#review").submit()},4e3)}});var o=setInterval(function(){a.submitted&&(e(".overlay").removeClass("active"),clearInterval(o))},500)},add_close:function(){e(".sub-menu").prepend('<i class="zmdi zmdi-close"></i>')},close_sub_menu:function(e){e.parents(".active").removeClass("active")},update_claim:function(){1==e("#claim").data("updateclaim")&&(e("#claim").find(".choose").hide(),e("#claim").find(".select").hide(),e("#claim").find(".proceed").show())}};e(document).ready(function(){a.init()})}(jQuery);